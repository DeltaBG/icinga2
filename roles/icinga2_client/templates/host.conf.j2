object Endpoint "{{ inventory_hostname }}" {
        host = "{{ ansible_host }}"
}

object Zone "{{ inventory_hostname }}" {
        endpoints = [ "{{ inventory_hostname }}" ]
        parent = "{{ icinga2_zone_master_endpoint_name }}"
}

object Host "{{ inventory_hostname }}" {
  import "generic-host"
  name = "{{ inventory_hostname }}"
  vars.agent_endpoint = name
  vars.client_endpoint = "{{ inventory_hostname }}"
  address = "{{ ansible_host }}"
  vars.os = "{{ ansible_system }}"
  vars.os_family = "{{ ansible_distribution }}"

  # IOstats plugin
  {% if ansible_devices.keys()|list is defined and ansible_devices.keys()|list|length>0 %}
    {% for disk in ansible_devices.keys()|list %}
      {% if "sr" not in disk %}

          vars.iostats_disks["iostat on {{ disk }}"] = {
            iostats_disk = "{{ disk }}"
        }
      {% endif %}     
    {% endfor %}
  {% endif %}

  # Disks plugin
  {% if ansible_facts.mounts is defined and ansible_facts.mounts|length>0 %}

    {% for mount in ansible_facts.mounts %}
      vars.disk_service["disk {{ mount.mount }}"] = {
        disk_partitions = "{{ mount.mount }}"
      }

    {% endfor %}
  {% endif %}
}
