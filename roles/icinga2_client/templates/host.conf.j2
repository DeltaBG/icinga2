object Endpoint "{{ inventory_hostname }}" {
        host = "{{ ansible_host }}"
}

object Zone "{{ inventory_hostname }}" {
        endpoints = [ "{{ inventory_hostname }}" ]
        parent = "{{ icinga2_zone_master_endpoint_name }}"
}

object Host "{{ inventory_hostname }}" {
  import "generic-host"
  name = "{{ inventory_hostname }}"
  vars.agent_endpoint = name
  vars.client_endpoint = "{{ inventory_hostname }}"
  address = "{{ ansible_host }}"
  vars.os = "{{ ansible_system }}"
  vars.os_family = "{{ ansible_distribution }}"

  # Custom client vars. Should be defined only in host_vars.
  {% if icinga2_custom_vars is defined %}
  {{ icinga2_custom_vars }}
  
  {% endif %}
  # End custom client vars.

  # IOstats plugin
  {% if ansible_devices.keys()|list is defined and ansible_devices.keys()|list|length>0 %}
    {% for disk in ansible_devices.keys()|list %}
      {% if "sr" not in disk %}

          vars.iostats_disks["iostat on {{ disk }}"] = {
            iostats_disk = "{{ disk }}"
        }
      {% endif %}     
    {% endfor %}
  {% endif %}

  # Disks plugin
  {% if ansible_facts.mounts is defined and ansible_facts.mounts|length>0 %}

    {% for mount in ansible_facts.mounts %}
      vars.disk_service["disk {{ mount.mount }}"] = {
        disk_partitions = "{{ mount.mount }}"
      }

    {% endfor %}
  {% endif %}

  # Swap plugin
  {% if ansible_facts.swaptotal_mb is defined and ansible_facts.swaptotal_mb>0 %}

    vars.swap_enabled = true
  {% else %}
    vars.swap_enabled = false
  {% endif %}

  # Load plugin
  {% if ansible_facts.processor_vcpus is defined %}

    vars.load_wload1 = {{ (ansible_facts.processor_vcpus * 1.5)|int }}
    vars.load_wload5 = {{ (ansible_facts.processor_vcpus * 1.4)|int }}
    vars.load_wload15 = {{ (ansible_facts.processor_vcpus * 1.3)|int }}
    vars.load_cload1 = {{ (ansible_facts.processor_vcpus * 2)|int }}
    vars.load_cload5 = {{ (ansible_facts.processor_vcpus * 1.9)|int }}
    vars.load_cload15 = {{ (ansible_facts.processor_vcpus * 1.8)|int }}
  {% endif %}

  {% if ansible_facts.smartctl is defined and ansible_facts.smartctl|length>0 %}

    {% for device in ansible_facts.smartctl.devices %}
        vars.smart_devices["smart_device {{ device.name }}"] = {
          smart_device = "{{ device.device }}"
          smart_type = "{{ device.type }}"
        }

    {% endfor %}
  {% endif %}

}
